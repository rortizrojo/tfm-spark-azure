node {
    def mvnHome = tool 'M3'
    stage('Preparation') { // for display purposes
        git branch: 'spark-submit',
                credentialsId: 'gitlab-credentials',
                url: 'https://gitlab.com/rortizrojo/tfm-spark-azure.git'
    }
    stage('Build') {
        if(skipBuild == 'false')
        {
            // Run the maven build
            withEnv(["MVN_HOME=$mvnHome"]) {
                if(skipTest == 'true') {
                    sh '"$MVN_HOME/bin/mvn" clean -DskipTests install'
                }
                else{
                    sh '"$MVN_HOME/bin/mvn" clean install'
                }

            }
        }
    }
    stage('Subida de ficheros') {
        sh """
            az login --service-principal -u http://ServicePrincipalJenkins --password ${password} --tenant ${tenant}
            bash ./scripts/tasks/spark-submit.sh "$parametros_spark_submit"
        """
    }
    stage('Results') {
        if(skipTest == 'false'){
            junit '**/target/surefire-reports/TEST-*.xml'
            //archiveArtifacts 'target/*.jar'
        }

    }
}

