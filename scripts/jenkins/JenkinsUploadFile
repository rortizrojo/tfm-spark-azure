node {
    def nombre_despliegue = 'despliequeFicheros'
    stage('Preparation') { // for display purposes
        git branch: 'uploadFile',
                credentialsId: 'gitlab-credentials',
                url: 'https://gitlab.com/rortizrojo/tfm-spark-azure.git'
    }
    stage('Subida de fichero'){
        sh """

            cd scripts/azure/
            python3 modifyStorageParameters.py -sf storage/parameters.json -sn $nombre_cuenta 
            cd storage/
            ls -la
            az login --service-principal -u http://ServicePrincipalJenkins --password 3ed4f5e0-18d1-46b7-bba8-a39b17e2c704 --tenant f07087f5-7fe3-4ffe-9c74-296b39ef9ca8
            bash ./deploy.sh -i $id_suscripcion -g $grupo_recursos -n $nombre_despliegue -l westeurope 
            export DATA_LAKE_MAIN_PATH=abfs://${contenedor}@${nombre_cuenta}.dfs.core.windows.net
            az storage account keys list --account-name $nombre_cuenta > ficheroKeys
            cat ficheroKeys
            keyStorage=`python3 parserKeyStorage.py ficheroKeys`
            bash ./upload.sh $nombre_cuenta \$keyStorage $contenedor ../../../input/MuestraDatos.csv muestraSubido.csv
        """
    }
}