node {
    def nombre_cuenta = 'otracuentadeprueba'
    def cuenta_cluster = 'almacenamiento_cluster'
    def nombre_usuario = 'Usuario30Julio'
    def id_suscripcion = '5a08e9e0-83ee-4188-8fc2-18e16c7db524'
    def grupo_recursos = 'grupoRecursosTest30Julio'
    def contenedor = 'contenedoralmacenamiento'
    def nombre_cluster = 'cluster-tfm-30-07-2019'

    stage('Preparation') { // for display purposes
        git branch: 'master',
                credentialsId: 'gitlab-credentials',
                url: 'https://gitlab.com/rortizrojo/tfm-spark-azure.git'
    }
    stage('test'){
        sh """
            cd scripts/azure/cluster
            az login --service-principal -u http://ServiceTestJenkins --password 2366f72d-73e1-47f5-bedd-9b2ca47f9b82 --tenant 50140386-fd10-4b25-8169-e67b2b0b2017
    
            # Create resource group
            az group create --name ${grupo_recursos} --location westeurope
    
            # Create managed identity
            az identity create -g ${grupo_recursos} -n ${nombre_usuario}
    
            az extension add --name storage-preview
    
            az storage account create --name $nombre_cuenta \\
                --resource-group  ${grupo_recursos} \\
                --location westeurope --sku Standard_LRS \\
                --kind StorageV2 --hierarchical-namespace true

            az group deployment create --name HDInsightADLSGen2Deployment \\
                --resource-group ${grupo_recursos} \\
                --template-file test/template.json \\
                --parameters test/param.json


        """

    }
}